services:
  homeassistant:
    container_name: HomeAssistant
    image: homeassistant/home-assistant:stable
    volumes:
      - type: volume
        source: /opt/homeassistant
        target: /config
      - type: volume
        source: /opt/hass/config
        target: /config
      - type: bind
        source: /etc/localtime
        target: /etc/localtime
        read_only: true
      - type: bind
        source: /var/run/dbus
        target: /var/run/dbus
      - type: bind
        source: /var/run/docker.sock
        target: /var/run/docker.sock
    privileged: true
    environment:
      - TZ=Europe/Amsterdam
    restart: unless-stopped
    network_mode: host
    healthcheck:
      test: 'curl -m 90 -sLf http://localhost:8123 || date >> /config/healthcheck'
      interval: 90s
      timeout: 60s
      retries: 2
